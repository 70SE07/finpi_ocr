# Философия и Идеология Проекта Finpi OCR

Этот документ описывает фундаментальные принципы, на которых строится проект. Это «Дух проекта», которому обязан следовать любой разработчик (человек или ИИ).

## 1. ЦКП как Религия (Ценный Конечный Продукт)
Мы не пишем код ради кода. Каждая функция, каждый модуль и каждый этап пайплайна обязаны выдавать **ЦКП** — четкий, атомарный и проверяемый результат. 
- Если результат нельзя увидеть, пощупать в JSON или проверить тестом — значит, функция спроектирована неверно.

## 2. Атомарность и SRP (Single Responsibility Principle)
Мы доводим SRP до абсолюта на уровне архитектуры элементов.
- **Один элемент = Одно действие.** 
- Мы не создаем «универсальных парсеров». Мы создаем цепочку узкоспециализированных инструментов.
- Лучше иметь 10 маленьких файлов с Trace-логикой, чем один большой «умный» файл.

## 3. Наследие как Вектор, а не Эталон (Legacy as Vector)
Код из папок `old_project` или внешних источников — это **Вектор** (направление мысли), а не **Эталон** (готовое решение).
- **Никогда** не копируйте старый код «как есть», если он нарушает принципы SRP или ЦКП.
- Весь входящий код должен быть переосмыслен и «переплавлен» в новую атомарную структуру перед интеграцией в основной пайплайн.

## 4. Эволюционный Подход (Step-by-Step Evolution)
Мы движемся от точки А в точку Б. 
- Мы не пытаемся решить всё сразу (напр. Deskewing на всех этапах). 
- Сначала завершаем текущий путь, получаем стабильный ЦКП, анализируем Trace и только потом принимаем решение о следующем шаге развития.

## 5. Системный подход (Systemic-First)
Мы решаем проблемы на уровне архитектуры и универсальных алгоритмов, а не локальных правок.
- **Запрет на костыли:** Никаких `if image_name == "..."`. Любая ошибка в чеке — это симптом, требующий улучшения алгоритма для 100+ локалей.
- **Масштабируемость:** Любое решение должно работать на 10 000+ вариаций чеков.

## 6. Contract-Driven Development
Весь проект строится на «Контрактах» между модулями.
- **Реестр:** Все обязательства модулей зафиксированы в `docs/architecture/contract_registry.md`.
- **Неизменность:** Изменение выходного формата (Specification) модуля — это критическое событие, требующее синхронизации всего пайплайна.

## 7. Прозрачность и Traceability (След Анализа)
Система должна быть «стеклянной».
- Любое решение системы (почему эта цена? почему эта строка — товар?) должно быть зафиксировано в `trace`. 
- Мы не верим в «магию» парсинга. Мы верим в проверяемый след логики.

## 8. Принцип быстрого отказа (Fail Fast)
Мы предпочитаем честный `Exception` тихому «мусору».
- Если данные на входе нарушают Контракт — модуль выбрасывает ошибку.
- Мы не пытаемся «догадываться» там, где данные явно невалидны (например, пустой OCR).

## 9. Наблюдаемость (Observability)
Логи — это не мусор, а летопись логики принятия решений.
- Каждый шаг алгоритма должен быть залогирован так, чтобы можно было восстановить «ход мыслей» системы без дебаггера.
- Используем уровни `trace` для детального разбора паттернов и `debug` для фактов выбора результата.

---
**Соблюдение этой философии обязательно. Если предлагаемое изменение нарушает эти принципы — оно должно быть отклонено, даже если оно «работает».**
