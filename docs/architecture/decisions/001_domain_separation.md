# ADR-001: Разделение на домены

**Статус:** Принято  
**Дата:** 2025-12-29  
**Вопрос плана:** Q1.2

---

## Контекст

Проект обрабатывает чеки из 100+ локалей через цепочку: Изображение -> OCR -> Parsing -> Категоризация.

Возникает вопрос: почему это 3 отдельных домена, а не один сервис?

---

## Вопрос

Почему Extraction (D1), Parsing (D2), Categorization (D3) - отдельные домены?

---

## Решение

### Принцип: SRP (Single Responsibility Principle)

Каждый домен имеет персональную ответственность и свой ЦКП (Ценный Конечный Продукт).

Нельзя смешивать ответственности в одном сервисе - это размывает ЦКП и усложняет понимание что именно гарантирует сервис.

### Принцип: Независимость

- D1 (Extraction) не влияет на D3 (Categorization)
- D3 не влияет на D1
- Домены связаны только через контракты/DTO

### Принцип: Заменяемость технологий

Каждый домен может использовать свою технологию:
- D1: Google Vision OCR (можно заменить на GPT-4 Vision)
- D2: Код (Python)
- D3: AI + правила

Замена технологии в одном домене не затрагивает другие домены.
D3 не знает и не должен знать, какой OCR используется в D1.
D3 получает контракт/DTO и работает с ним.

---

## Последствия

1. **Контракты обязательны** - между доменами должны быть стабильные контракты
2. **Независимое развитие** - можно улучшать D1 не трогая D2/D3
3. **Кэширование** - результат D1 можно кэшировать и переиспользовать
4. **Тестирование** - каждый домен тестируется независимо
5. **Ответственность** - четко понятно кто за что отвечает
