# –ü–ª–∞–Ω —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ Finpi OCR

## –°—Ç–∞—Ç—É—Å
**–í —Ä–∞–±–æ—Ç–µ** (31.12.2024)

### –ü—Ä–æ–≥—Ä–µ—Å—Å
- [x] –§–∞–∑–∞ 1.1: –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –Ω–∞ Pydantic
- [x] –§–∞–∑–∞ 1.2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –≤ –∫–æ–¥
- [x] –§–∞–∑–∞ 2.1: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ stages/
- [x] –§–∞–∑–∞ 2.2: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —ç—Ç–∞–ø–æ–≤ –∏ –ø–∞–π–ø–ª–∞–π–Ω–∞
- [x] –§–∞–∑–∞ 2.3: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- [x] –§–∞–∑–∞ 3.1: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞ —Å–æ —Å–∫—Ä–∏–ø—Ç–∞–º–∏
- [x] –§–∞–∑–∞ 3.2: –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –§–∞–∑–∞ 3.3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –Ω–∞ Ground Truth
- [ ] –§–∞–∑–∞ 3.4: –ê–≤–∞—Ä–∏–π–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- [ ] –§–∞–∑–∞ 3.5: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –≤–∏–¥–µ–Ω–∏—é
- [ ] –§–∞–∑–∞ 4.1: README –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- [ ] –§–∞–∑–∞ 4.2: –ê—É–¥–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## –¶–µ–ª—å

–ü—Ä–∏–≤–µ—Å—Ç–∏ –∫–æ–¥–æ–≤—É—é –±–∞–∑—É –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å —É—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π (ADR-001 ‚Äî ADR-015) –∏ –æ–±–µ—Å–ø–µ—á–∏—Ç—å 100% –∫–∞—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —á–µ–∫–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ PROJECT_VISION.

---

## –§–∞–∑–∞ 1: –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### 1.1 –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –Ω–∞ Pydantic

**–ü—Ä–æ–±–ª–µ–º–∞:** `contracts/d1_extraction_dto.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `dataclass`, –Ω–µ Pydantic. –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:**
```python
# contracts/d1_extraction_dto.py
from pydantic import BaseModel, Field, field_validator

class BoundingBox(BaseModel):
    x: int = Field(..., ge=0)
    y: int = Field(..., ge=0)
    width: int = Field(..., gt=0)
    height: int = Field(..., gt=0)

class Word(BaseModel):
    text: str = Field(..., min_length=1)
    bounding_box: BoundingBox
    confidence: float = Field(1.0, ge=0.0, le=1.0)

class RawOCRResult(BaseModel):
    full_text: str = ""
    words: list[Word] = Field(default_factory=list)
    metadata: OCRMetadata | None = None
    
    model_config = ConfigDict(frozen=True)
```

**–§–∞–π–ª—ã:**
- [x] `contracts/d1_extraction_dto.py` ‚Äî –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –Ω–∞ Pydantic ‚úÖ
- [x] `contracts/d2_parsing_dto.py` ‚Äî –ø—Ä–æ–≤–µ—Ä–µ–Ω, Pydantic v2 ‚úÖ
- [x] `contracts/d3_categorization_dto.py` ‚Äî –æ–±–Ω–æ–≤–ª—ë–Ω –Ω–∞ Pydantic v2 ‚úÖ
- [x] `contracts/README.md` ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ ‚úÖ

---

### 1.2 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –≤ –∫–æ–¥

**–ü—Ä–æ–±–ª–µ–º–∞:** `src/` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∏–∑ `contracts/`.

**–†–µ—à–µ–Ω–∏–µ:**
- D1 (`src/extraction/`) –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `RawOCRResult` –∏–∑ `contracts/`
- D2 (`src/parsing/`) –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω–∏–º–∞—Ç—å `RawOCRResult` –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `RawReceiptDTO`

**–§–∞–π–ª—ã:**
- [x] `contracts/raw_ocr_schema.py` ‚Äî –£–î–ê–õ–Å–ù (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π dataclass) ‚úÖ
- [x] `contracts/__init__.py` ‚Äî –æ–±–Ω–æ–≤–ª—ë–Ω, —ç–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö DTO ‚úÖ
- [x] `src/extraction/infrastructure/ocr/google_vision_ocr.py` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `RawOCRResult` –∏–∑ `contracts/` ‚úÖ
- [x] `src/extraction/domain/interfaces.py` ‚Äî —Ç–∏–ø—ã –∏–∑ `contracts/` ‚úÖ
- [x] `src/extraction/application/extraction_pipeline.py` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `RawOCRResult` ‚úÖ
- [x] `scripts/extract_raw_ocr.py` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `contracts.d1_extraction_dto` ‚úÖ
- [x] `scripts/parse_receipt.py` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `contracts.d1_extraction_dto` ‚úÖ

---

## –§–∞–∑–∞ 2: –ü–∞–π–ø–ª–∞–π–Ω D2 –ø–æ ADR-015

### 2.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ–∫—É—â–∏–π –ø–∞–π–ø–ª–∞–π–Ω –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —É—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–º 6 —ç—Ç–∞–ø–∞–º.

**–†–µ—à–µ–Ω–∏–µ:** –†–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è `src/parsing/`:

```
src/parsing/
‚îú‚îÄ‚îÄ stages/                    # 6 —ç—Ç–∞–ø–æ–≤ –ø–∞–π–ø–ª–∞–π–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ 1_layout_processor.py      # Layout Processing
‚îÇ   ‚îú‚îÄ‚îÄ 2_locale_detector.py       # Locale Detection
‚îÇ   ‚îú‚îÄ‚îÄ 3_store_detector.py        # Store Detection
‚îÇ   ‚îú‚îÄ‚îÄ 4_metadata_extractor.py    # Metadata Extraction
‚îÇ   ‚îú‚îÄ‚îÄ 5_semantic_extractor.py    # Semantic Extraction (Items)
‚îÇ   ‚îî‚îÄ‚îÄ 6_validator.py             # Validation (Checksum)
‚îú‚îÄ‚îÄ application/
‚îÇ   ‚îî‚îÄ‚îÄ parsing_pipeline.py        # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —ç—Ç–∞–ø–æ–≤
‚îú‚îÄ‚îÄ locales/                   # –ö–æ–Ω—Ñ–∏–≥–∏ –ª–æ–∫–∞–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ de_DE/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.yaml
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stores/            # Store configs (–∏—Å–∫–ª—é—á–µ–Ω–∏—è)
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ lidl.yaml
‚îÇ   ‚îî‚îÄ‚îÄ pl_PL/
‚îÇ       ‚îî‚îÄ‚îÄ config.yaml
‚îî‚îÄ‚îÄ domain/
    ‚îú‚îÄ‚îÄ interfaces.py          # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —ç—Ç–∞–ø–æ–≤
    ‚îî‚îÄ‚îÄ exceptions.py
```

**–§–∞–π–ª—ã:**
- [x] `src/parsing/stages/__init__.py` ‚Äî —ç–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤ ‚úÖ
- [x] `src/parsing/stages/stage_1_layout.py` ‚Äî Layout Processing ‚úÖ
- [x] `src/parsing/stages/stage_2_locale.py` ‚Äî Locale Detection ‚úÖ
- [x] `src/parsing/stages/stage_3_store.py` ‚Äî Store Detection ‚úÖ
- [x] `src/parsing/stages/stage_4_metadata.py` ‚Äî Metadata Extraction ‚úÖ
- [x] `src/parsing/stages/stage_5_semantic.py` ‚Äî Semantic Extraction ‚úÖ
- [x] `src/parsing/stages/stage_6_validation.py` ‚Äî Validation (Checksum) ‚úÖ
- [x] `src/parsing/stages/pipeline.py` ‚Äî ParsingPipeline (–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä) ‚úÖ

---

### 2.2 –ö–∞–∂–¥—ã–π —ç—Ç–∞–ø ‚Äî SRP

–ü–æ ADR-013 (Clean Code, SRP) –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø –∏–º–µ–µ—Ç:
- –°–≤–æ–π –¶–ö–ü
- –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```python
# src/parsing/domain/interfaces.py
from abc import ABC, abstractmethod

class ILayoutProcessor(ABC):
    @abstractmethod
    def process(self, raw_ocr: RawOCRResult) -> LayoutResult: ...

class ILocaleDetector(ABC):
    @abstractmethod
    def detect(self, layout: LayoutResult) -> str: ...

class IStoreDetector(ABC):
    @abstractmethod
    def detect(self, layout: LayoutResult, locale_config: LocaleConfig) -> StoreResult | None: ...

# ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ –¥–ª—è –≤—Å–µ—Ö 6 —ç—Ç–∞–ø–æ–≤
```

---

## –§–∞–∑–∞ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 3.1 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ —Å–∫—Ä–∏–ø—Ç–∞–º–∏

**–°—Ç–∞—Ç—É—Å:** –ó–ê–í–ï–†–®–ï–ù–û

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä—è–º–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–±–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä–∞ ‚Äî over-engineering –¥–ª—è R&D —Å—Ç–µ–Ω–¥–∞).

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:**
- [x] `scripts/run_d2_pipeline.py` ‚Äî —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ ParsingPipeline ‚úÖ
- [x] `scripts/compare_pipelines.py` ‚Äî —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ OLD (ReceiptParser) vs NEW (ParsingPipeline) ‚úÖ

**–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- [x] `src/extraction/application/factory.py` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –ø–æ–¥ –Ω–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ExtractionPipeline ‚úÖ

**–ü–µ—Ä–≤—ã–π —Ç–µ—Å—Ç (IMG_1292.jpeg):**
```
D1: 358 —Å–ª–æ–≤, 7 —Å–µ–∫
D2: 78 —Å—Ç—Ä–æ–∫ -> de_DE -> 35 —Ç–æ–≤–∞—Ä–æ–≤ -> CHECKSUM FAILED (diff: 602.62)
```
Checksum fail –æ–∂–∏–¥–∞–µ–º ‚Äî —ç—Ç–∞–ø—ã —Ç—Ä–µ–±—É—é—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω–∞ –∏—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞).

---

### 3.2 Checksum –≤–∞–ª–∏–¥–∞—Ü–∏—è

**–°—Ç–∞—Ç—É—Å:** –ó–ê–í–ï–†–®–ï–ù–û (Stage 6 —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)

**–†–µ—à–µ–Ω–∏–µ:** –≠—Ç–∞–ø 6 (Validator) –≤ –ø–∞–π–ø–ª–∞–π–Ω–µ:

```python
# src/parsing/stages/6_validator.py
class ChecksumValidator:
    TOLERANCE = 0.05  # ADR-011
    
    def validate(self, items: list[Item], receipt_total: float) -> ValidationResult:
        items_sum = sum(item.total for item in items)
        difference = abs(items_sum - receipt_total)
        
        if difference <= self.TOLERANCE:
            return ValidationResult(passed=True, difference=difference)
        else:
            # –ü–æ ADR-009: —ç—Ç–æ –±–∞–≥ —Å–∏—Å—Ç–µ–º—ã, –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞ —á–µ–∫–∞
            raise ChecksumMismatchError(
                f"Checksum failed: items_sum={items_sum}, receipt_total={receipt_total}, diff={difference}"
            )
```

---

### 3.3 –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°—Ç–∞—Ç—É—Å:** –ó–ê–í–ï–†–®–ï–ù–û

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –Ω–æ–≤—ã–π ParsingPipeline —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ —Ö—É–∂–µ —Å—Ç–∞—Ä–æ–≥–æ ReceiptParser.

#### –û—Ç–ª–∞–¥–∫–∞ Stage 4 –∏ Stage 5 (2026-01-01)

**–ü—Ä–æ–±–ª–µ–º—ã –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—Å–∏—Å—Ç–µ–º–Ω—ã–µ):**

| –ü—Ä–æ–±–ª–µ–º–∞ | Stage | –†–µ—à–µ–Ω–∏–µ |
|----------|-------|---------|
| –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ 12.31 –≤–º–µ—Å—Ç–æ 143.37 | Stage 4 | –î–æ–±–∞–≤–ª–µ–Ω `betrag` –≤ TOTAL_KEYWORDS; —É–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∏–∂–Ω–µ–π —á–∞—Å—Ç–∏, –Ω–∞–∏–±–æ–ª—å—à–∞—è —Å—É–º–º–∞) |
| –°—Ç—Ä–æ–∫–∏ –≤–µ—Å–∞ –ø–∞—Ä—Å—è—Ç—Å—è –∫–∞–∫ —Ç–æ–≤–∞—Ä—ã | Stage 5 | –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ç—Ç–µ—Ä–Ω `WEIGHT_LINE_PATTERNS` –¥–ª—è `X,XXX kg x Y,YY EUR/kg` |
| –°—Ç—Ä–æ–∫–∏ –∏—Ç–æ–≥–æ–≤ –ø–∞—Ä—Å—è—Ç—Å—è –∫–∞–∫ —Ç–æ–≤–∞—Ä—ã | Stage 5 | –î–æ–±–∞–≤–ª–µ–Ω—ã `zu zahlen`, `karte`, `kartenzahlung` –≤ SKIP_KEYWORDS |
| –ù–∞–ª–æ–≥–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –ø–∞—Ä—Å—è—Ç—Å—è –∫–∞–∫ —Ç–æ–≤–∞—Ä—ã | Stage 5 | –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ç—Ç–µ—Ä–Ω `TAX_LINE_PATTERNS` –¥–ª—è `A 7 %`, `B 19 %` |
| qty=29 –≤–º–µ—Å—Ç–æ qty=2 (–∏–∑ —Ü–µ–Ω—ã 4,29) | Stage 5 | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω regex –¥–ª—è quantity: `(?:^|\s)(\d{1,3})\s*[xX√ó]\s*(?:\d|$)` |

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

| –ß–µ–∫ | –õ–æ–∫–∞–ª—å | –†–µ–∑—É–ª—å—Ç–∞—Ç | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----|--------|-----------|-------------|
| IMG_1292 | de_DE | **PASSED** | Checksum: 143.37 = 143.37 |
| IMG_1336 | de_DE | **PASSED** | Checksum: 146.32 = 146.32 |
| IMG_1352 | de_DE | FAILED (diff: 37.02) | –¢—Ä–µ–±—É–µ—Ç –æ—Ç–ª–∞–¥–∫–∏ |
| PL_001 | pl_PL | FAILED (diff: 98.57) | –¢—Ä–µ–±—É–µ—Ç –æ—Ç–ª–∞–¥–∫–∏ |
| PT_001 | pt_PT | FAILED (diff: 0.99) | –¢—Ä–µ–±—É–µ—Ç –æ—Ç–ª–∞–¥–∫–∏ |

**–°–∫—Ä–∏–ø—Ç:** `scripts/compare_pipelines.py`

```bash
# –û–¥–∏–Ω —á–µ–∫
python3 scripts/compare_pipelines.py data/input/IMG_1292.jpeg

# –í—Å–µ —á–µ–∫–∏
python3 scripts/compare_pipelines.py --all

# –ü–µ—Ä–≤—ã–µ 5 —á–µ–∫–æ–≤
python3 scripts/compare_pipelines.py --all --limit 5
```

**–ú–µ—Ç—Ä–∏–∫–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:**
- locale_match ‚Äî —Å–æ–≤–ø–∞–¥–∞–µ—Ç –ª–∏ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –ª–æ–∫–∞–ª—å
- total_match ‚Äî —Å–æ–≤–ø–∞–¥–∞–µ—Ç –ª–∏ –∏—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ (¬±0.01)
- items_match ‚Äî —Å–æ–≤–ø–∞–¥–∞–µ—Ç –ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤
- time_ratio ‚Äî –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ NEW/OLD

---

### 3.4 –ê–≤–∞—Ä–∏–π–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

**–°—Ç–∞—Ç—É—Å:** –í –ü–†–û–¶–ï–°–°–ï (üî¥ –í–´–°–û–ß–ê–ô–®–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)

**–ü—Ä–∏–Ω—Ü–∏–ø:** Ground Truth ‚Äî –Ω–µ–ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–Ω—ã–π —ç—Ç–∞–ª–æ–Ω. –í—Å–µ –ø—Ä–æ–≤–∞–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏ –≤ —Å–∏—Å—Ç–µ–º–µ.

**–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π:**

| –ß–µ–∫ | –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π | –î–µ–¥–ª–∞–π–Ω |
|-----|-------------|--------|---------------|---------|
| IMG_1352 | +37.02 EUR | üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô | Lead Developer | 24 —á–∞—Å–∞ |
| PL_001 | +98.57 PLN | üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô | PL Locale Expert | 48 —á–∞—Å–æ–≤ |
| PT_001 | +0.99 EUR | üü° –í–´–°–û–ö–ò–ô | Core Team | 72 —á–∞—Å–∞ |

**–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è –æ—Ç–ª–∞–¥–∫–∏:**

1. **–ü–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ–≥–æ–Ω —á–µ—Ä–µ–∑ —ç—Ç–∞–ø—ã –ø–∞–π–ø–ª–∞–π–Ω–∞** —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
2. **–í–∏–∑—É–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞** —Å –ø–æ–º–æ—â—å—é –Ω–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ `scripts/debug_pipeline.py`
3. **RCA (Root Cause Analysis)** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–≤–∞–ª–µ–Ω–Ω–æ–≥–æ checksum

**–ù–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
- [ ] `scripts/debug_pipeline.py` ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã –ø–∞–π–ø–ª–∞–π–Ω–∞
- [ ] `scripts/step_by_step_debug.py` ‚Äî –ø–æ—à–∞–≥–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å –≤—ã–≤–æ–¥–æ–º –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] `logs/pipeline_debug/` ‚Äî –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –ª–æ–≥–æ–≤ –æ—Ç–ª–∞–¥–∫–∏

**–ü—Ä–∞–≤–∏–ª–∞:**
- –ù–∏–∫—Ç–æ –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –∏–∑–º–µ–Ω—è—Ç—å Ground Truth –¥–∞–Ω–Ω—ã–µ
- –ö–∞–∂–¥—ã–π –ø—Ä–æ–≤–∞–ª–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç = —Å–∏—Å—Ç–µ–º–Ω—ã–π –±–∞–≥, —Ç—Ä–µ–±—É—é—â–∏–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ (—É—Ä–æ–≤–µ–Ω—å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤, –Ω–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —á–µ–∫–æ–≤)

---

### 3.5 –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –≤–∏–¥–µ–Ω–∏—é

**–°—Ç–∞—Ç—É—Å:** –ü–õ–ê–ù–ò–†–£–ï–¢–°–Ø

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ–∫—É—â–∏–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Ç–æ–ª—å–∫–æ checksum, –Ω–æ –≤–∏–¥–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç 100% –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ –≤—Å–µ–º –º–µ—Ç—Ä–∏–∫–∞–º:
1. –¢–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ (0 —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π)
2. –¢–æ—á–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ (1 –≤ 1)
3. –¢–æ—á–Ω—ã–µ —Ü–µ–Ω—ã (0.00 —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π)

**–†–µ—à–µ–Ω–∏–µ:** –†–∞—Å—à–∏—Ä–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```python
# –ù–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ scripts/test_vision_metrics.py
test_metrics = {
    'checksum': abs(parsed.total - gt.total) <= 0.05,
    'items_count': len(parsed.items) == len(gt.items),
    'item_names_match': all(name_similarity(p.name, g.name) > 0.9 
                           for p, g in zip(parsed.items, gt.items)),
    'item_prices_exact': all(abs(p.unit_price - g.unit_price) < 0.001 
                           for p, g in zip(parsed.items, gt.items))
}
```

**–ù–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:**
- [ ] `scripts/test_vision_metrics.py` ‚Äî –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫ –≤–∏–¥–µ–Ω–∏—è
- [ ] `scripts/generate_validation_report.py` ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è–º
- [ ] `tests/vision/test_zero_tolerance.py` ‚Äî —Ç–µ—Å—Ç—ã –Ω–∞ –Ω—É–ª–µ–≤—É—é —Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å

**–ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞:**
- [ ] 100% —á–µ–∫–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç checksum (¬±0.05)
- [ ] 100% —á–µ–∫–æ–≤ –∏–º–µ—é—Ç —Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤
- [ ] 95%+ —á–µ–∫–æ–≤ –∏–º–µ—é—Ç —Ç–æ—á–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ (similarity > 0.9)
- [ ] 100% —á–µ–∫–æ–≤ –∏–º–µ—é—Ç —Ç–æ—á–Ω—ã–µ —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–æ–≤

---

## –§–∞–∑–∞ 4: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### 4.1 README –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

**–§–∞–π–ª:** `README.md`

```markdown
## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –§–∞–π–ª `config/google_credentials.json` —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏.

- –ù–ò–ö–û–ì–î–ê –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤ Git
- –§–∞–π–ª —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore`
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `GOOGLE_APPLICATION_CREDENTIALS`
```

---

### 4.2 –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã –≤ –∫–æ–¥–µ.

**–†–µ—à–µ–Ω–∏–µ:** –ê—É–¥–∏—Ç –∏ –≤—ã–Ω–æ—Å –≤ `config/settings.py`:
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –Ω–∞ –º–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞
- [ ] –í—ã–Ω–µ—Å—Ç–∏ –≤ `settings.py` —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
- [ ] –°–æ–∑–¥–∞—Ç—å `config/constants.py` –¥–ª—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç –∏–∑ ADR

---

## üî¥ –í–ê–ñ–ù–û–ï –ü–†–ê–í–ò–õ–û: –ù–ï–ü–†–ò–ö–û–°–ù–û–í–ï–ù–ù–û–°–¢–¨ GROUND TRUTH

**Ground Truth –≤ `docs/ground_truth/` ‚Äî –∞–±—Å–æ–ª—é—Ç–Ω—ã–π —ç—Ç–∞–ª–æ–Ω, –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –∏ —É—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–π –∞–≤—Ç–æ—Ä–æ–º –ø—Ä–æ–µ–∫—Ç–∞.**

### –ó–ê–ü–†–ï–©–ï–ù–û:
- –ò–∑–º–µ–Ω—è—Ç—å —Ñ–∞–π–ª—ã Ground Truth
- –ü—Ä–µ–¥–ª–∞–≥–∞—Ç—å "–∏—Å–ø—Ä–∞–≤–∏—Ç—å" Ground Truth
- –°—á–∏—Ç–∞—Ç—å, —á—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤ Ground Truth

### –ï–î–ò–ù–°–¢–í–ï–ù–ù–ê–Ø –î–û–ü–£–°–¢–ò–ú–ê–Ø –†–ï–ê–ö–¶–ò–Ø –Ω–∞ –ø—Ä–æ–≤–∞–ª–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç:
**"–í —Å–∏—Å—Ç–µ–º–µ –µ—Å—Ç—å –±–∞–≥. –ò—â–µ–º –∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ–º."**

---

## –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

| –§–∞–∑–∞ | –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å |
|------|--------|-----------|--------|
| **3.4** | **–ê–≤–∞—Ä–∏–π–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã** | üî¥üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô | IN PROGRESS |
| 3.4.1 | –û—Ç–ª–∞–¥–∫–∞ IMG_1352 (diff: 37.02) | üî¥üî¥ | TODO |
| 3.4.2 | –û—Ç–ª–∞–¥–∫–∞ PL_001 (diff: 98.57) | üî¥üî¥ | TODO |
| 3.4.3 | –û—Ç–ª–∞–¥–∫–∞ PT_001 (diff: 0.99) | üî¥ | TODO |
| **3.5** | **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –≤–∏–¥–µ–Ω–∏—é** | üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô | TODO |
| 1.1 | –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –Ω–∞ Pydantic | ‚úÖ | DONE |
| 1.2 | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ | ‚úÖ | DONE |
| 2.1 | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ stages/ | ‚úÖ | DONE |
| 2.2 | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —ç—Ç–∞–ø–æ–≤ | ‚úÖ | DONE |
| 2.3 | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ | ‚úÖ | DONE |
| 3.1 | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ —Å–∫—Ä–∏–ø—Ç–∞–º–∏ | ‚úÖ | DONE |
| 3.2 | Checksum –≤–∞–ª–∏–¥–∞—Ü–∏—è | ‚úÖ | DONE |
| 3.3 | –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚úÖ | DONE |
| 4.1 | README –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | üü¢ | TODO |
| 4.2 | –ê—É–¥–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ | üü¢ | TODO |

---

## –ö—Ä–∏—Ç–µ—Ä–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

–†–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∫–æ–≥–¥–∞:

1. ‚úÖ **0 FAILED —Ç–µ—Å—Ç–æ–≤** ‚Äî –≤—Å–µ Ground Truth —á–µ–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç checksum (¬±0.05)
2. ‚úÖ **–í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –≤–∏–¥–µ–Ω–∏—è** –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤, –∏–º–µ–Ω–∞, —Ü–µ–Ω—ã)
3. ‚úÖ **Ground Truth –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ–ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–Ω—ã–º** (–Ω–∏ –æ–¥–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
4. ‚úÖ **–°–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è** –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
5. ‚úÖ **–ö–∞–∂–¥—ã–π –ø—Ä–æ–≤–∞–ª–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç** –∏–º–µ–µ—Ç RCA –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
6. ‚úÖ **–ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –Ω–∞ Pydantic** —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
7. ‚úÖ **–ü–∞–π–ø–ª–∞–π–Ω D2** = 6 —ç—Ç–∞–ø–æ–≤ (Layout‚ÜíLocale‚ÜíStore‚ÜíMetadata‚ÜíItems‚ÜíValidation)

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [PROJECT_VISION.md](PROJECT_VISION.md) ‚Äî —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã (100% –∫–∞—á–µ—Å—Ç–≤–æ, –Ω–µ–ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–Ω–æ—Å—Ç—å Ground Truth)
- [ADR-015: –≠—Ç–∞–ø—ã –ø–∞–π–ø–ª–∞–π–Ω–∞ D2](architecture/decisions/015_d2_pipeline_stages.md)
- [ADR-013: Clean Code –∏ SRP](architecture/decisions/013_clean_code_srp.md)
- [ADR-011: –°—Ç—Ä–∞—Ç–µ–≥–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏](architecture/decisions/011_validation_strategy.md)
- [ADR-009: –ì–∞—Ä–∞–Ω—Ç–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞ D2](architecture/decisions/009_d2_quality_guarantees.md)