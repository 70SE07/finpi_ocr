# Lidl (de_DE) - Полный анализ

## Обзор
- **Всего чеков:** 19 (из них 1 дубликат, 1 pt_PT)
- **Уникальных чеков de_DE:** 16
- **Диапазон дат:** 31.05.2025 - 06.12.2025
- **Диапазон сумм:** 4,09 - 179,24 EUR
- **Филиалы:**
  - Overath-Vilkerath (основной) - 13 чеков
  - St. Augustin - 1 чек
  - Heiden - 1 чек

## Ground Truth файлы

| ID | Файл | Дата | Сумма | Особенности |
|----|------|------|-------|-------------|
| 001 | IMG_1292.jpeg | 31.07.25 | 143,37 | Первый анализ, мясо+овощи |
| 015 | IMG_1390.jpeg | ранее | 18,57 | Ранее проанализирован |
| 037 | IMG_1336.jpeg | 07.08.25 | 146,32 | 24 позиции, мясо |
| 038 | IMG_1442.jpeg | 18.08.25 | 65,40 | Сигареты, напитки |
| 039 | IMG_1761.jpeg | 11.09.25 | 25,87 | Только мясо, 3 поз. |
| 040 | IMG_1867.jpeg | 17.09.25 | 24,74 | Bio Rindergulasch |
| 041 | IMG_1868.jpeg | 18.09.25 | 20,97 | St. Augustin |
| 042 | IMG_2643.jpeg | 23.10.25 | 44,81 | Молочка со скидками |
| 043 | IMG_2852.jpeg | 11.11.25 | 105,79 | Крупный, 38 поз. |
| 044 | IMG_2853.jpeg | 11.11.25 | 105,79 | Дубликат 043 |
| 045 | IMG_2964.jpeg | 24.11.25 | 23,10 | Bar (наличные), Bio |
| 046 | IMG_2974.jpeg | 25.11.25 | 22,78 | Алкоголь (Rum) |
| 047 | IMG_2975.jpeg | 25.11.25 | 4,09 | Минимальный чек |
| 048 | IMG_3017.jpeg | 06.12.25 | 179,24 | Самый крупный! |
| 049 | IMG_3024.jpeg | 31.05.25 | 25,99 | Только Red Bull |
| 050 | IMG_3062.jpeg | 05.11.25 | 11,41 | Heiden, весовой |
| 051 | IMG_3094.jpeg | 21.05.25 | 43,55 | Pfandrückgabe |
| 052 | pfandruckgabe_001.jpeg | 13.06.25 | 13,48 | 92x возврат тары! |

## Метаданные чека

| Поле | Значение |
|------|----------|
| Магазин | Lidl |
| Адрес | Steinhauser Auel 1, 51491 Overath-Vilkerath (основной) |
| Валюта | EUR |
| Способы оплаты | Karte (girocard), Kreditkarte (VISA, MasterCard), Bar |
| Tax Classes | A (7%), B (19%) |

## Структура чека

```
┌─────────────────────────────────────────┐
│ [Логотип Lidl]                          │
│ Steinhauser Auel 1                      │
│ 51491 Overath-Vilkerath                 │
│                                    EUR  │
├─────────────────────────────────────────┤
│ ТОВАРНЫЕ ПОЗИЦИИ                        │
│ Schweinenackenbraten           10,85 A  │
│     1,207 kg x 8,99 EUR/kg              │
│ ...                                     │
├─────────────────────────────────────────┤
│ zu zahlen                      143,37   │
│ Karte/Bar                      143,37   │
│ [Rückgeld]                     [-0,01]  │
│ Gesamter Preisvorteil            4,44   │
├─────────────────────────────────────────┤
│ MWSTx    MWST  +  Netto  = Brutto       │
│ A 7%     7,34    104,90   112,24        │
│ B 19%    4,97     26,16    31,13        │
│ Summe   12,31    131,06   143,37        │
├─────────────────────────────────────────┤
│ TSE Transaktionsnummer: 1207294         │
│ [Штрих-код]                             │
│ K-U-N-D-E-N-B-E-L-E-G                   │
│ Kartenzahlung girocard                  │
│ Betrag              143,37 EUR          │
└─────────────────────────────────────────┘
```

## Паттерны товарных строк

### Тип 1: Весовой товар (две строки)
```
Schweinenackenbraten                    10,85 A
    1,207 kg x 8,99 EUR/kg
```
- Первая строка: название + итоговая сумма + tax class
- Вторая строка: qty + unit + "x" + unit_price + "EUR/kg"
- Math: 1,207 * 8,99 = 10,85 (с округлением)

### Тип 2: Штучный товар с множителем (одна строка)
```
Fairtrade Rosen          2,99 x 4       11,96 A
```
- Формат: название + unit_price + "x" + qty + total + tax
- Math: 2,99 * 4 = 11,96

### Тип 3: Простой товар (qty=1)
```
Dill                                     1,39 A
```
- Формат: название + total + tax
- qty = 1, unit_price = total_price

### Тип 4: Скидка
```
Preisvorteil                            -0,30
RABATT 20%                              -1,60
Rabattaktion                            -0,27
Aktionsrabatt                           -0,22
```
- Всегда отрицательное значение
- Ключевые слова: Preisvorteil, RABATT, Rabattaktion, Aktionsrabatt
- Идет СРАЗУ ПОСЛЕ товара, к которому относится

### Тип 5: Pfand (залог)
```
Pfand 0,25 M             0,25 x 2        0,50 B
Pfand 0,25 EM            0,25 x 24       6,00 B
Pfand 0,25 7%EM          0,25            0,25 A
Pfand 6,00 M                             6,00 B
```
- Классы: M, EM, 7%M, 7%EM
- Tax class обычно B (19%), но 7% = A
- Pfand 6,00 - большая упаковка (блок)

### Тип 6: Pfandrückgabe (возврат тары)
```
Pfandrückgabe           -92 x 0,25     -23,00 B
Pfandrückgabe 0%                        -6,75 B
```
- Отрицательные значения
- Может быть очень большим (92 бутылки!)
- Влияет на налоговый блок (может быть отрицательным)

## Checksum валидация

### Все 16 чеков: Расхождение 0,00

| ID | items_sum | receipt_total | discrepancy |
|----|-----------|---------------|-------------|
| 001 | 143,37 | 143,37 | 0,00 |
| 015 | 18,57 | 18,57 | 0,00 |
| 037 | 146,32 | 146,32 | 0,00 |
| 038 | 65,40 | 65,40 | 0,00 |
| 039 | 25,87 | 25,87 | 0,00 |
| 040 | 24,74 | 24,74 | 0,00 |
| 041 | 20,97 | 20,97 | 0,00 |
| 042 | 44,81 | 44,81 | 0,00 |
| 043 | 105,79 | 105,79 | 0,00 |
| 045 | 23,10 | 23,10 | 0,00 |
| 046 | 22,78 | 22,78 | 0,00 |
| 047 | 4,09 | 4,09 | 0,00 |
| 048 | 179,24 | 179,24 | 0,00 |
| 049 | 25,99 | 25,99 | 0,00 |
| 050 | 11,41 | 11,41 | 0,00 |
| 051 | 43,55 | 43,55 | 0,00 |
| 052 | 13,48 | 13,48 | 0,00 |

## Особенности Lidl

### 1. Tax Classes
- **A = 7%** - продукты питания
- **B = 19%** - непродовольственные, алкоголь, напитки

### 2. Pfand System
- 0,25 EUR - стандартная бутылка
- 6,00 EUR - блок (24 бутылки)
- EM = Einweg Mehrweg
- M = Mehrweg
- 7% = продуктовый залог (редко)

### 3. Скидочная система
- **Preisvorteil** - персональная скидка (Lidl Plus)
- **RABATT 20%** - скидка на мясо (истекающий срок)
- **Rabattaktion** - акционная скидка
- **Aktionsrabatt** - скидка по акции

### 4. Способы оплаты
- **Karte (girocard)** - дебетовая карта
- **Kreditkarte (VISA/MasterCard)** - кредитная карта
- **Bar** - наличные (Rückgeld = сдача)

### 5. Горизонтальные фото
- IMG_3017 и IMG_3094 сняты горизонтально
- Требуется поворот на 90°

## Выводы для DTO

### Обязательные поля:
- `raw_name` - название как на чеке
- `total_price` - итого по позиции

### Важные поля (70-80%):
- `quantity` - количество (float)
- `unit_price` - цена за единицу
- `tax_class` - A или B
- `is_discount` - boolean

### Опциональные поля:
- `unit` - kg, pcs
- `weight_kg` - для весовых
- `price_per_kg` - для весовых
- `discount_type` - Preisvorteil, RABATT, etc.
