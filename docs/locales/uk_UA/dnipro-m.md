# Dnipro-M (uk_UA)

## Источник
- **Файл:** data/input/UA_001.jpeg
- **Дата анализа:** 2025-12-26
- **Дата чека:** (не указана на видимой части)

## Метаданные чека

| Поле | Значение |
|------|----------|
| Сеть | Dnipro-M (МЕРЕЖА САЛОНІВ МАЙСТЕРНОСТІ) |
| Юр. лицо | ТОВ "ДМ ТЕХ" |
| Адрес | м. Запоріжжя, пр-т. Металургів, 12 |
| ПН | 45440344 |
| Каса | N1 |
| Валюта | UAH (гривня) |
| Способ оплаты | Картка (VISA, ПриватБанк) |
| Итого | 15 305 ГРН |
| Бонусы | 845 |

## Структура чека

```
┌─────────────────────────────────────────┐
│ DNIPRO-M                                │
│ МЕРЕЖА САЛОНІВ МАЙСТЕРНОСТІ             │
│ Фірмовий магазин "Dnipro-M"             │
│ ТОВ "ДМ ТЕХ"                            │
│ м. Запоріжжя, пр-т. Металургів, 12      │
│ ПН 45440344                             │
│ Касир                                   │
│ Каса N1                                 │
├─────────────────────────────────────────┤
│ ITEMS (многострочный формат)            │
│                                         │
│ 1 шт X 234 =                            │
│ Щітка по металу Dnipro-M T125-L         │
│ торцева, г офр. дрі                     │
│                             234 Я       │
│ Знижка                                  │
│                             -35 Я       │
│ ...                                     │
├─────────────────────────────────────────┤
│ Бонусів на :                            │
│ 845                                     │
│ Покупець:                               │
│ Александровна Надежна                   │
│ Системний номер: 27                     │
│ номер чека:                             │
│ 329E00010799001B                        │
│ Карта:                                  │
│ 380669397443                            │
│ На початок:                             │
│ 845                                     │
│ Використано:                            │
│ 0                                       │
│ Нараховано:                             │
│ 0                                       │
├─────────────────────────────────────────┤
│ АТ КБ "ПРИВАТБАНК"                      │
│ S11707F8                                │
│ Оплата                                  │
│ ЕПЗ 4486XXXXXXXXX7181                   │
│ ПЛАТІЖНА СИСТЕМА VISA                   │
│ КОД ТРАНЗ. 104169864129                 │
│ КОД АВТ. 143258                         │
│ БЕЗГОТІВКОВА        15 305 ГРН          │
│ Картка                                  │
├─────────────────────────────────────────┤
│ СУМА                    15 305          │
│ Без ПДВ Я = неоп             0          │
└─────────────────────────────────────────┘
```

## Паттерны товарных строк

### Формат товара (МНОГОСТРОЧНЫЙ!)
```
1 шт X 234 =
Щітка по металу Dnipro-M T125-L торцева, г
офр. дрі
                                    234 Я
Знижка
                                    -35 Я
```

**Структура:**
- Строка 1: `[qty] шт X [unit_price] =`
- Строки 2-N: Название товара (может переноситься)
- Строка N+1: `[total] Я` (tax class в конце)
- Строка N+2: `Знижка` (если есть)
- Строка N+3: `[discount] Я`

### Товар без скидки
```
1 шт X 2 400 =
Шліфмашина кутова Dnipro-M GL-160SE
                                  2 400 Я
```

### Товар со скидкой
```
1 шт X 4 248 =
Шліфмашина кутова Dnipro-M GS-160SE (2021)
                                  4 248 Я
Знижка
                                   -637 Я
```

## Ground Truth таблица

| # | qty | raw_name | unit_price | total_price | discount | net_price | tax |
|---|-----|----------|------------|-------------|----------|-----------|-----|
| 1 | 1 | Щітка по металу Dnipro-M T125-L торцева, г офр. дрі | 234 | 234 | -35 | 199 | Я |
| 2 | 1 | Щітка по металу Dnipro-M T100-L торцева, г офр. дрі | 189 | 189 | -28 | 161 | Я |
| 3 | 1 | Фарбопульт електричний Dnipro-M SF-100 | 3 300 | 3 300 | -495 | 2 805 | Я |
| 4 | 1 | Шліфмашина кутова Dnipro-M GS-160SE (2021) | 4 248 | 4 248 | -637 | 3 611 | Я |
| 5 | 1 | Шліфмашина кутова Dnipro-M GL-160SE | 2 400 | 2 400 | 0 | 2 400 | Я |
| 6 | 1 | Дриль ударний Dnipro-M HD-120M | 2 100 | 2 100 | 0 | 2 100 | Я |
| 7 | 1 | Перфоратор бочковий Dnipro-M BH-20 | 4 740 | 4 740 | -711 | 4 029 | Я |

## Checksum валидация

```
Расчет итого (net_price = total_price + discount):

199 + 161 + 2805 + 3611 + 2400 + 2100 + 4029 = 15 305

СУМА на чеке: 15 305 ✓
```

**Расхождение: 0.00**

## Выводы для DTO

| Поле | Присутствует | Пример | Комментарий |
|------|--------------|--------|-------------|
| raw_name | Да | "Шліфмашина кутова..." | Многострочное! |
| quantity | Да | 1 | Всегда целое |
| unit | Да | "шт" | Всегда штуки |
| unit_price | Да | 4 248 | Целое число |
| total_price | Да | 4 248 | Целое число |
| tax_class | Да | "Я" | Единственный |
| is_discount | Да | true | "Знижка" |
| discount_amount | Да | -637 | Отдельное поле |

## Особенности для парсинга

1. **МНОГОСТРОЧНЫЙ ФОРМАТ** - название может занимать 2-3 строки
2. **Формат qty:** `1 шт X [цена] =` на отдельной строке
3. **Tax class "Я"** в конце каждой строки с ценой
4. **Знижка** (скидка) как отдельная строка после товара
5. **Целые числа** - без копеек
6. **Пробел** как разделитель тысяч (4 248)
7. **Бонусная система** с детальной информацией
8. **ПДВ = 0** - товары без НДС (Без ПДВ Я = неоп)

## Сложности

1. **Объединение многострочного названия** - нужен алгоритм
2. **Отделение товара от скидки** - "Знижка" как маркер
3. **Парсинг чисел с пробелами** - 4 248 → 4248

